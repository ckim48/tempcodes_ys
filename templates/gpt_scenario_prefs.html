{% extends "base.html" %}
{% block content %}

<style>
:root {
  --ink:#2b2b2b;
  --muted:#6b6b6b;
  --primary:#574545;
  --secondary:#ab8e8e;
  --bg:#fdfcfc;
  --surface:#ffffff;
  --edge:#e8e3e3;
  --shadow:0 8px 24px rgba(87,69,69,0.08);
}
body { background:linear-gradient(180deg,#faf9f9 0%, #f5f2f2 100%); color:var(--ink); font-family:'Inter', system-ui, sans-serif; }
.page { max-width:960px; margin:0 auto; padding:1.5rem; }

.page-head{ display:flex; justify-content:space-between; align-items:end; flex-wrap:wrap; gap:1rem; margin-bottom:1.25rem; }
.title-wrap h1{ font-weight:800; color:var(--primary); margin:0; letter-spacing:.15px; }
.title-wrap p{ color:var(--muted); margin:.3rem 0 0; font-size:.95rem; }

.card{ background:var(--surface); border:1px solid var(--edge); border-radius:16px; box-shadow:var(--shadow); }
.card-body{ padding:1.5rem; }

.form-grid{ display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
.form-grid .full{ grid-column:1 / -1; }
label{ font-weight:700; color:var(--primary); margin-bottom:.25rem; display:block; }
select, input[type="text"]{
  width:100%; padding:.7rem .9rem; border:1px solid var(--edge); border-radius:10px; background:#fff; color:var(--ink);
}

.small{ font-size:.9rem; color:var(--muted); }

.btn-primary{
  background:var(--primary); color:#fff; border:none; border-radius:10px; padding:.75rem 1.2rem; font-weight:700; letter-spacing:.2px;
  transition:all .2s ease;
}
.btn-primary:hover{ background:var(--secondary); box-shadow:0 6px 18px rgba(171,142,142,0.35); transform:translateY(-1px); }

.help{ color:var(--muted); font-size:.9rem; margin-top:.25rem; }
@media (max-width:768px){ .form-grid{ grid-template-columns:1fr; } }

/* Loading overlay */
#loading-overlay{ display:none; position:fixed; inset:0; background:rgba(253,252,252,.88); z-index:9999; }
.spinner{ width:56px; height:56px; border:5px solid #e8e3e3; border-top-color:#ab8e8e; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto; }
@keyframes spin { to { transform: rotate(360deg); } }
</style>

<div class="page">
  <div class="page-head">
    <div class="title-wrap">
      <h1>Create a New War Scenario</h1>
      <p>Choose a historical war and context. We’ll generate a <strong>5-step</strong>, age-appropriate scenario with paragraph-length backgrounds and <strong>4 choices per step</strong>.</p>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <form method="post" action="{{ url_for('gpt_scenario_prefs') }}" onsubmit="
        document.getElementById('loading-overlay').style.display='block';
        this.querySelector('button[type=submit]').disabled = true;
      ">
        <div class="form-grid">
          <!-- War (historical) -->
          <div>
            <label for="war">Historical War <span class="small">(required)</span></label>
            <select id="war" name="war" required>
              <option value="" disabled selected>Select a war</option>
              <option value="ww1">World War I (1914–1918)</option>
              <option value="ww2">World War II (1939–1945)</option>
              <option value="korean-war">Korean War (1950–1953)</option>
              <option value="vietnam-war">Vietnam War (1955–1975)</option>
              <option value="gulf-war-1991">Gulf War (1990–1991)</option>
              <option value="bosnian-war">Bosnian War (1992–1995)</option>
              <option value="iraq-war-2003">Iraq War (2003–2011)</option>
              <option value="afghanistan-war">War in Afghanistan (2001–2021)</option>
              <option value="falklands-war">Falklands War (1982)</option>
              <option value="spanish-civil-war">Spanish Civil War (1936–1939)</option>
              <option value="american-civil-war">American Civil War (1861–1865)</option>
              <option value="crimean-war">Crimean War (1853–1856)</option>
              <option value="napoleonic-wars">Napoleonic Wars (1803–1815)</option>
              <option value="thirty-years-war">Thirty Years’ War (1618–1648)</option>
              <option value="peloponnesian-war">Peloponnesian War (431–404 BCE)</option>
            </select>
            <div class="help">Educational, neutral framing—no graphic detail; focus on ethics (distinction, proportionality, IHL).</div>
          </div>

          <!-- Theatre / Front auto-fills from war -->
          <div>
            <label for="theatre">Theatre / Front <span class="small">(auto-suggested)</span></label>
            <select id="theatre" name="theatre">
              <option value="" selected>Auto (suggest for me)</option>
            </select>
            <div class="help">We’ll prefill based on the selected war; you can leave it as Auto.</div>
          </div>

          <!-- Role -->
          <div>
            <label for="role">Perspective / Role</label>
            <select id="role" name="role">
              <option value="field-commander" selected>Field commander</option>
              <option value="medic">Medic</option>
              <option value="intelligence-officer">Intelligence officer</option>
              <option value="humanitarian-coordinator">Humanitarian coordinator</option>
              <option value="war-reporter">War reporter (embedded)</option>
            </select>
            <div class="help">Affects the type of dilemmas you’ll face.</div>
          </div>

          <!-- Civilians -->
          <div>
            <label for="civilians">Civilians</label>
            <select id="civilians" name="civilians">
              <option value="present" selected>present</option>
              <option value="evacuated">evacuated</option>
              <option value="unknown status">unknown status</option>
            </select>
          </div>

          <!-- Tone -->
          <div>
            <label for="tone">Tone</label>
            <select id="tone" name="tone">
              <option value="serious & age-appropriate" selected>serious & age-appropriate</option>
              <option value="reflective">reflective</option>
              <option value="case-study">case-study</option>
            </select>
          </div>

          <!-- Optional learning goal -->
          <div class="full">
            <label for="goal">Learning Goal (optional)</label>
            <input id="goal" name="goal" type="text" placeholder="e.g., practice proportionality vs. mission urgency">
          </div>

          <!-- Generate cover image (optional) -->
          <div class="full" style="margin-top:.25rem;">
            <label for="make_image" style="display:flex; align-items:center; gap:.6rem; font-weight:700; color:var(--primary);">
              <input id="make_image" name="make_image" type="checkbox" value="1"
                     style="width:1.05rem; height:1.05rem; accent-color: var(--primary); border-radius:6px;">
              Generate cover image
            </label>
            <div class="help">Creates one age-appropriate, non-graphic illustration based on your selections.</div>
          </div>
        </div>

        <div style="text-align:right; margin-top:1rem;">
          <button class="btn-primary" type="submit">Generate Scenario</button>
        </div>
      </form>

      <p class="small" style="margin-top:.75rem;">
        Note: We present dilemmas respectfully and avoid graphic detail. Scenarios are adapted for learning ethics, not simulating violence.
      </p>
    </div>
  </div>
</div>

<!-- Loading overlay -->
<div id="loading-overlay">
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center;">
    <div class="spinner"></div>
    <p style="margin-top:12px; color:#574545; font-weight:700;">Generating your scenario…</p>
    <p style="margin:0; color:#6b6b6b; font-size:.9rem;">This usually takes a few seconds.</p>
  </div>
</div>

<script>
/**
 * Populate theatre/front options based on selected war.
 */
const WAR_THEATRES = {
  "ww1": ["Western Front", "Eastern Front", "Gallipoli", "Italian Front", "Middle East"],
  "ww2": ["Europe", "Pacific", "North Africa", "Eastern Front", "Italy"],
  "korean-war": ["Korean Peninsula", "Pusan Perimeter", "Incheon–Seoul", "Chosin Reservoir"],
  "vietnam-war": ["Central Highlands", "Mekong Delta", "DMZ Region", "Hanoi–Haiphong"],
  "gulf-war-1991": ["Kuwait Theatre", "Iraq Desert", "Saudi Border"],
  "bosnian-war": ["Sarajevo", "Eastern Bosnia", "Mostar Region"],
  "iraq-war-2003": ["Baghdad", "Anbar Province", "Basra", "Nineveh"],
  "afghanistan-war": ["Kabul", "Kandahar", "Helmand", "Kunar–Nangarhar"],
  "falklands-war": ["East Falkland", "West Falkland", "Surrounding Seas"],
  "spanish-civil-war": ["Madrid Front", "Aragon Front", "Ebro", "Andalusia"],
  "american-civil-war": ["Eastern Theater", "Western Theater", "Trans-Mississippi"],
  "crimean-war": ["Crimean Peninsula", "Sevastopol", "Balaklava"],
  "napoleonic-wars": ["Iberian Peninsula", "Central Europe", "Russia Campaign", "Italy"],
  "thirty-years-war": ["Central Europe", "Bohemia", "The Rhineland"],
  "peloponnesian-war": ["Attica", "Peloponnese", "Sicily"]
};

const warSel = document.getElementById('war');
const theatreSel = document.getElementById('theatre');

function repopulateTheatres() {
  const war = warSel.value;
  const options = WAR_THEATRES[war] || [];
  theatreSel.innerHTML = '<option value="" selected>Auto (suggest for me)</option>';
  options.forEach(t => {
    const opt = document.createElement('option');
    opt.value = t;
    opt.textContent = t;
    theatreSel.appendChild(opt);
  });
}

if (warSel && theatreSel) {
  warSel.addEventListener('change', repopulateTheatres);
}
</script>

{% endblock %}
